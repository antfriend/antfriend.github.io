<!DOCTYPE html>
<html>
  <head>
      <title>Antfriend</title>
      <style type="text/css">
        body {
        font: 10pt sans;
        background-color: #000000;
        }
        #mynetwork {
        width: 100%;
        height: 700px;
        border: 1px solid lightgray;
        background-color: #000000;
        }

        div.left {
        position:relative;
        float:left;
        width:300px;
        border: 1px #c7c7c7 solid;
        height:590px;
        padding:5px;
        }

        div.right {
        padding-left:10px;
        float:left;
        width:600px;
        }

        div.bottom {
        position:absolute;
        bottom:5px;
        }
      </style>
      <!--<script type="text/javascript" src="./vis/exampleUtil.js"></script>-->
      <script type="text/javascript" src="./vis/vis.js"></script>
      <link href="./vis/vis.css" rel="stylesheet" type="text/css" />
      <script src="bower_components/jquery/dist/jquery.js"></script>
      <script src="bower_components/jquery.terminal/js/jquery.terminal-0.11.3.min.js"></script>
      <script src="bower_components/jquery.terminal/js/jquery.mousewheel-min.js"></script>
      <!--<link href="css/jquery.terminal-0.11.2.min.css" rel="stylesheet"/>-->
      <!--http://terminal.jcubic.pl/-->
      <link href="https://cdnjs.cloudflare.com/ajax/libs/jquery.terminal/0.11.2/css/jquery.terminal.min.css" rel="stylesheet"/>
      <script type="text/javascript">
          jQuery(function($, undefined) {
            $('#antfriend_console').terminal(function(command, term) {
                if (command !== '') {
                    try {
                        var result = window.eval(command);
                        if (result !== undefined) {
                            term.echo(new String(result));
                        }
                    } catch(e) {
                        term.error(new String(e));
                    }
                } else {
                  term.echo('');
                }
            }, {
                greetings: '@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\nAntfriend is your friend \n@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@\n"help()" to see a list of commands',
                name: 'antfriend_console',
                height: 100,
                prompt: 'ant> '
            });
        });
      </script>
      <script type="text/javascript">
        var nodes = null;
        var edges = null;
        var network = null;
        var offsetx, offsety, scale, positionx, positiony, duration, easingFunction, doButton, focusButton, showButton;
        var statusUpdateSpan;
        var finishMessage = '';
        var showInterval = false;
        var showPhase = 1;
        //var amountOfNodes = 10;
        var nodeId = 1;

        function destroy() {
          if (network !== null) {
            network.destroy();
            network = null;
          }
        }

        function updateValues() {
          offsetx = 0;// parseInt(document.getElementById('offsetx').value);
          offsety = 0;// parseInt(document.getElementById('offsety').value);
          duration = 5000;// parseInt(document.getElementById('duration').value);
          scale = 1.0; //parseFloat(document.getElementById('scale').value);
          positionx = 300; //parseInt(document.getElementById('positionx').value);
          positiony = 300; //parseInt(document.getElementById('positiony').value);
          easingFunction = "easeInOutQuart";// document.getElementById('easingFunction').value;
        }

        function pageLoadGlory(){
          draw();
          startShow();
        }

        function Get(yourUrl){
          var Httpreq = new XMLHttpRequest(); // a new request
          Httpreq.open("GET",yourUrl,false);
          Httpreq.send(null);
          return Httpreq.responseText;
    }

        function getData(){
          var data = {};
          var json_obj = JSON.parse(Get('./vis/data.json'));
          data = json_obj.data;
          return data;
        }

        function getDataByCallback(callback){
          getJSON('./vis/data.json').then(function(result) {
            var data = result.data;
            nodes = data.nodes;
            edges = data.edges;
              //alert('Your Json result is:  ' + data); //you can comment this, i used it to debug
              callback(data); //display the result in an HTML element
          }, function(status) { //error detection....
            alert('Something went wrong.');
          });
          
        }



        function getJSON(url) {
          return new Promise(function(resolve, reject) {
            var xhr = new XMLHttpRequest();
            xhr.open('get', url, true);
            xhr.responseType = 'json';
            xhr.onload = function() {
              var status = xhr.status;
              if (status == 200) {
                resolve(xhr.response);
              } else {
                reject(status);
              }
            };
            xhr.send();
          });
        };

        function draw() {
          destroy();
          statusUpdateSpan = document.getElementById('statusUpdate');
          doButton = document.getElementById('btnDo');
          focusButton = document.getElementById('btnFocus');
          showButton = document.getElementById('btnShow');

          // randomly create some nodes and edges
          //var data = getData();
          

          // create a network
          var container = document.getElementById('mynetwork');
          var options = {
              "edges": {
              "smooth": {
                "forceDirection": "none"
              }
            },
            physics: {
              stabilization: {
                iterations: 1200
              }
            }
          };

          getDataByCallback(function(data){
            network = new vis.Network(container, data, options);
            // add event listeners
            network.on('select', function(params) {
              document.getElementById('selection').innerHTML = 'Selection: ' + params.nodes;
            });
            network.on('stabilized', function (params) {
              document.getElementById('stabilization').innerHTML = 'Stabilization took ' + params.iterations + ' iterations.';
            });
            network.on('animationFinished', function() {
              statusUpdateSpan.innerHTML = finishMessage;
            })
            network.on('click', function() {
              statusUpdateSpan.innerHTML = 'clicked!';
              showInterval = false;
            })
          })
          

        }

        function fitAnimated() {
          updateValues();

          var options = {offset: {x:offsetx,y:offsety},
            duration: duration,
            easingFunction: easingFunction
          };
          statusUpdateSpan.innerHTML = 'Doing fit() Animation.';
          finishMessage = 'Animation finished.';
          network.fit({animation:options});
        }

        function doDefaultAnimation() {
          updateValues();

          var options = {
            position: {x:positionx,y:positiony},
            scale: scale,
            offset: {x:offsetx,y:offsety},
            animation: true // default duration is 1000ms and default easingFunction is easeInOutQuad.
          };
          statusUpdateSpan.innerHTML = 'Doing Animation.';
          finishMessage = 'Animation finished.';
          network.moveTo(options);
        }

        function doAnimation() {
          updateValues();

          var options = {
            position: {x:positionx,y:positiony},
            scale: scale,
            offset: {x:offsetx,y:offsety},
            animation: {
              duration: duration,
              easingFunction: easingFunction
            }
          };
          statusUpdateSpan.innerHTML = 'Doing Animation.';
          finishMessage = 'Animation finished.';
          network.moveTo(options);
        }

        function moveTheNode()
        {
          if(nodeId)
          {
            network.moveNode(nodeId, 2,2) 
          }     
        }

        function focusRandom() {
          if(nodes){
            nodeId = nodes[Math.floor(Math.random() * nodes.length)].id;
          }else{
            nodeId = null;
          }
          
          
          updateValues();
          //moveTheNode();
          
          
          var options = {
            // position: {x:positionx,y:positiony}, // this is not relevant when focusing on nodes
            scale: scale,
            offset: {x:offsetx,y:offsety},
            animation: {
              duration: duration,
              easingFunction: easingFunction
            }
          };
          if(nodeId)
          {
            statusUpdateSpan.innerHTML = 'Focusing on node: ' + nodeId;
            finishMessage = 'Node: ' + nodeId + ' in focus.';
            network.focus(nodeId, options);
          }else{
            statusUpdateSpan.innerHTML = 'Focusing on NO node: ';
            finishMessage = 'Node NOT in focus.';
          }
        }

        function start()
        {
          startShow();
        }

        function stop()
        {
          showInterval = false;
        }


        function startShow() {
          updateValues();
          
          if (showInterval !== false) {
            showInterval = false;
            //showButton.value = 'begin';
            network.fit();
          }
          else {
            //showButton.value = 'cease';
            focusRandom();
            setTimeout(doTheShow, duration);
            showInterval = true;
          }
        }

        function doTheShow() {
          updateValues();
          if (showInterval == true) {
            if (showPhase == 0) {
              focusRandom();
              showPhase = 1;
            }
            else {
              //fitAnimated();
              focusRandom();
              showPhase = 0;
            }
            setTimeout(doTheShow, duration);
            moveTheNode();
          }
          //do nothing
        }

        function help()
        {
          return 'start()\nstop()\n'
        }
      </script>
      
  </head>
    <body onload="pageLoadGlory();">
       
      <div class="">
        <div id="mynetwork"></div>
        <div>
          <br/>
          <span class="terminal" id="stabilization"></span>
          <span class="terminal" id="statusUpdate"></span>
          <span class="terminal" id="selection"></span>
          <br/>
        </div>
        <div id="antfriend_console"></div>
      </div>
  </body>
</html>